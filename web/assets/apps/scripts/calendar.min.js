var AppCalendar = function () {
    var setCalender = "";
    var refresh = "";
    return {
        init: function () {
            this.initCalendar()
        }, initCalendar: function () {
            if (jQuery().fullCalendar) {
                var e = new Date, t = e.getDate(), a = e.getMonth(), n = e.getFullYear(), r = {};

                App.isRTL() ? $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = {
                    right: "title, prev, next",
                    center: "",
                    left: "agendaDay, agendaWeek, month, today"
                }) : ($("#calendar").removeClass("mobile"), r = {
                    right: "title",
                    center: "",
                    left: "agendaDay, agendaWeek, month, today, prev,next"
                }) : $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = {
                    left: "title, prev, next",
                    center: "",
                    right: "today,month,agendaWeek,agendaDay"
                }) : ($("#calendar").removeClass("mobile"), r = {
                    left: "title",
                    center: "",
                    right: "prev,next,today,month,agendaWeek,agendaDay"
                });
                var l = function (e) {
                    var t = {title: $.trim(e.text())};
                    e.data("eventObject", t), e.draggable({zIndex: 999, revert: !0, revertDuration: 0})
                }, o = function (e) {
                    e = 0 === e.length ? "" : e;
                    var t = $('<div class="external-event label label-default">' + e + "</div>");
                    jQuery("#event_box").append(t), l(t)
                };
                $("#external-events div.external-event").each(function () {
                    l($(this))
                }),


                    $("#calendar").fullCalendar("destroy"),
                    $("#calendar").fullCalendar({
                        header: r,
                        defaultView: "month",
                        selectable: true,
                        editable: !0,
                        droppable: !0,



                        dayClick: function (date, jsEvent, view) {
                            if (date < e) {
                                //TRUE Clicked date smaller than today + daysToadd
                                alert("Event cannot be created on days that have past!");
                            } else {
                                //FLASE Clicked date larger than today + daysToadd
                                $('#calendarModal').modal();
                                $('#startDateTime').val(date)
                            }



                            $("#event_add").unbind("click").click(function () {
                                $("#calendarModal").modal('hide');

                                var x = document.getElementById("event_title").value;
                                var xy = document.getElementById("event_description").value;
                                var startDateTime = document.getElementById("startDateTime").value;
                                var endDateTime = document.getElementById("endDateTime").value;


                                $.ajax({
                                    url: '/eventServlet',
                                    data: {
                                        postVariableName: x,
                                        postVariableName1: xy,
                                        postVariableName2: startDateTime,
                                        postVariableName3: endDateTime,

                                    },
                                    type: 'POST',


                                    success: function (responseText) {
                                        alert(responseText)
                                        setCalender = responseText;

                                       // alert(date)
                                        console.log(date)

                                        $('#calendar').fullCalendar('renderEvent', {
                                            title: x,
                                            start: date,
                                            end: endDateTime,
                                        }, true)

                                    },
                                });


                                $("#event_title").val("");
                                $("#event_description").val("");

                            })
                        },


                        eventRender: function(event, element) {

                            element.click(function() {

                                //set the modal values and open
                                $('#eventTitle').html(event.title);
                                $('#eventDescription').html(event.description);
                                var getDescription = $(this).find(('event_description')).val();
                               // alert("OLD OLD OLD " + event.title);
                                $.ajax({
                                    url: '/eventServlet',
                                    data: {

                                        headEvent : event.title,
                                       description : event.description
                                    },
                                    type: 'GET',
                                    success: function (responseText) {

                                    }
                                })



                                // Rebind the Remove button click handler
                                $("#removeBtn").off('click').on('click', function(e) {
                                    $('#calendar').fullCalendar('removeEvents', event._id);
                                    var check = confirm("Are you sure you want to remove the event?");

                                    var eventId = refresh ;
                                    if (check == true) {
                                        $.ajax({
                                            url: '/eventServlet',
                                            data: {
                                                removed1: eventId,

                                            },
                                            type: 'GET',
                                            success: function (responseText) {
                                              alert("Event is removed");
                                            }
                                        })
                                    }
                                    else {

                                    }


                                });

                                $('#modalRemove').modal();
                            });

                            $("#editBtn").off('click').on('click', function(e) {
                                $("#editModal").modal();
                            });


                               $("#update_event").off('click').on('click', function(e){
                                    alert("HI")

                                   var edit_title = document.getElementById("editEvent_title").value;
                                   var edit_description = document.getElementById("editEvent_description").value;

                                   //alert("passing to servlet t: "+edit_title);
                                   //alert("passing to servlet d: "+edit_description);
                                    $.ajax({

                                        url: '/updateServlet',
                                        data: {
                                            updateTitle: edit_title,
                                            updateDescription:edit_description,
                                            original: refresh

                                        },
                                        type:'GET',
                                        success: function(responseText){
                                            alert("Event updated");
                                        }


                                    })

                                })



                        }




                    })

                window.onload = function () {

                    var getCalendar = $(this).find(('event_title')).val();
                    $.ajax({
                        url: '/eventServlet',
                        data: {

                            getCalendar: getCalendar,

                        },
                        type: 'GET',
                        success: function (event_title) {
                            refresh = event_title;
                            $('#calendar').fullCalendar('renderEvent', {
                                title: refresh,
                                start: '2016-02-03',
                                end: '2016-02-05',
                            }, true);
                        }
                    })


                }

            }

        }


    }
}();
jQuery(document).ready(function () {
    AppCalendar.init()

});